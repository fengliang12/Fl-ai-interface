# æµ‹è¯•ç³»ç»Ÿé›†æˆ

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»é¡¹ç›®çš„æµ‹è¯•ç³»ç»Ÿæ¶æ„ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•å’ŒE2Eæµ‹è¯•çš„é…ç½®ã€å®ç°å’Œæœ€ä½³å®è·µã€‚

## å®‰è£…æµ‹è¯•ä¾èµ–

### å•å…ƒæµ‹è¯•ä¾èµ–

```bash
# Jest æµ‹è¯•æ¡†æ¶å’Œç›¸å…³å·¥å…·
npm install --save-dev jest@30.1.3
npm install --save-dev jest-environment-jsdom@30.1.2
npm install --save-dev @jest/globals@30.0.5

# React æµ‹è¯•å·¥å…·
npm install --save-dev @testing-library/react@16.3.0
npm install --save-dev @testing-library/jest-dom@6.8.0
npm install --save-dev @testing-library/user-event@14.6.1

# SWC ç¼–è¯‘å™¨ï¼ˆç”¨äºå¿«é€Ÿç¼–è¯‘ï¼‰
npm install --save-dev @swc/jest@0.2.39
npm install --save-dev @swc/core@1.13.3

# æµ‹è¯•æŠ¥å‘Šå·¥å…·
npm install --save-dev jest-stare@2.5.2

# æ¨¡æ‹Ÿå·¥å…·
npm install --save-dev identity-obj-proxy@3.0.0
```

### E2Eæµ‹è¯•ä¾èµ–

```bash
# Cypress E2E æµ‹è¯•æ¡†æ¶
npm install --save-dev cypress@15.2.0

# Web3 æµ‹è¯•å·¥å…·
npm install --save-dev @synthetixio/synpress@4.1.1
npm install --save-dev @cypress/webpack-preprocessor@7.0.1

# å…¶ä»–æµ‹è¯•å·¥å…·
npm install --save-dev puppeteer@24.15.0
npm install --save-dev selenium-webdriver@4.34.0
```

## æ ¸å¿ƒé…ç½®æ–‡ä»¶

### å•å…ƒæµ‹è¯•é…ç½®

- **jest.config.js** - Jest ä¸»é…ç½®æ–‡ä»¶
- **src/setupTests.js** - æµ‹è¯•ç¯å¢ƒè®¾ç½®
- **jest.setup.js** - å…¨å±€æµ‹è¯•è®¾ç½®
- **jest-stare.json** - æµ‹è¯•æŠ¥å‘Šé…ç½®

### E2Eæµ‹è¯•é…ç½®

- **cypress.config.js** - Cypress ä¸»é…ç½®æ–‡ä»¶
- **tests/e2e/support/e2e.js** - E2E æµ‹è¯•æ”¯æŒæ–‡ä»¶
- **tests/e2e/support/commands.js** - è‡ªå®šä¹‰å‘½ä»¤å®šä¹‰
- **tests/e2e/fixtures/** - æµ‹è¯•æ•°æ®æ–‡ä»¶

## å…³é”®é…ç½®è¦ç‚¹

### Jest é…ç½® (jest.config.js)

```javascript
module.exports = {
  // æµ‹è¯•ç¯å¢ƒè®¾ç½®ä¸º jsdom (æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ)
  testEnvironment: 'jsdom',

  // æµ‹è¯•è®¾ç½®æ–‡ä»¶
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.js'],
  setupFiles: ['<rootDir>/jest.setup.js'],

  // æ¨¡å—è·¯å¾„æ˜ å°„
  moduleNameMapper: {
    // CSS æ–‡ä»¶æ˜ å°„
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
    // å›¾ç‰‡æ–‡ä»¶æ˜ å°„
    '\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':
      'jest-transform-stub',
    // è·¯å¾„åˆ«åæ˜ å°„
    '^@/(.*)$': '<rootDir>/src/$1',
  },

  // æµ‹è¯•æ–‡ä»¶åŒ¹é…æ¨¡å¼
  testMatch: [
    '<rootDir>/tests/unit/**/*.{test,spec}.{js,jsx,ts,tsx}',
    '<rootDir>/src/**/*.{test,spec}.{js,jsx,ts,tsx}',
  ],

  // å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•
  testPathIgnorePatterns: [
    '<rootDir>/node_modules/',
    '<rootDir>/dist/',
    '<rootDir>/build/',
    '<rootDir>/tests/e2e/',
    '<rootDir>/cypress/',
  ],

  // æ”¶é›†æµ‹è¯•è¦†ç›–ç‡
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
    '!src/reportWebVitals.ts',
  ],

  // è¦†ç›–ç‡æŠ¥å‘Šæ ¼å¼
  coverageReporters: ['text', 'lcov', 'html'],

  // è½¬æ¢é…ç½®
  transform: {
    '^.+\\.(ts|tsx)$': '@swc/jest',
    '^.+\\.(js|jsx)$': 'babel-jest',
  },

  // Jest Stare æŠ¥å‘Šé…ç½®
  reporters: [
    'default',
    [
      'jest-stare',
      {
        resultDir: 'jest-stare',
        reportTitle: 'Web3 Frontend Tests',
        coverageLink: '../coverage/lcov-report/index.html',
      },
    ],
  ],
};
```

### Cypress é…ç½® (cypress.config.js)

```javascript
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  e2e: {
    // åŸºç¡€URLï¼ŒæŒ‡å‘æœ¬åœ°å¼€å‘æœåŠ¡å™¨
    baseUrl: 'http://localhost:3000',

    // æµ‹è¯•æ–‡ä»¶å­˜æ”¾ç›®å½•
    specPattern: 'tests/e2e/**/*.cy.{js,jsx,ts,tsx}',

    // æ”¯æŒæ–‡ä»¶ç›®å½•
    supportFile: 'tests/e2e/support/e2e.js',

    // è§†å£è®¾ç½®
    viewportWidth: 1280,
    viewportHeight: 720,

    // æµ‹è¯•è¶…æ—¶è®¾ç½®ï¼ˆWeb3äº¤äº’å¯èƒ½è¾ƒæ…¢ï¼‰
    defaultCommandTimeout: 10000,
    requestTimeout: 10000,
    responseTimeout: 10000,
    pageLoadTimeout: 30000,

    // åœ¨æµ‹è¯•å¤±è´¥æ—¶å½•åˆ¶è§†é¢‘å’Œæˆªå›¾
    video: true,
    screenshotOnRunFailure: true,

    // Web3 æµ‹è¯•ç¯å¢ƒå˜é‡
    env: {
      WALLET_PRIVATE_KEY: 'test_private_key_here',
      TEST_ACCOUNT_ADDRESS: '0x742d35Cc6634C0532925a3b8D0C9e3e0C8b0e8e8',
      NETWORK_URL: 'http://localhost:8545',
    },

    // å¿½ç•¥Web3ç›¸å…³é”™è¯¯
    chromeWebSecurity: false,

    // é‡è¯•é…ç½®
    retries: {
      runMode: 2,
      openMode: 0,
    },
  },
});
```

## å•å…ƒæµ‹è¯•ç³»ç»Ÿ

### æµ‹è¯•æ¶æ„

```
tests/unit/
â”œâ”€â”€ components/              # React ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ AddRedPacket.test.jsx   # æ·»åŠ çº¢åŒ…ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ Dashboard.test.jsx      # ä»ªè¡¨æ¿ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ SendRedPacket.test.jsx  # å‘é€çº¢åŒ…ç»„ä»¶æµ‹è¯•
â”‚   â””â”€â”€ TopInfo.test.jsx        # é¡¶éƒ¨ä¿¡æ¯ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ hooks/                   # React Hooks æµ‹è¯•
â”‚   â”œâ”€â”€ useENS.test.js         # ENS Hook æµ‹è¯•
â”‚   â””â”€â”€ useWallet.test.js      # é’±åŒ… Hook æµ‹è¯•
â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°æµ‹è¯•
    â”œâ”€â”€ getName.test.js        # è·å–åç§°å‡½æ•°æµ‹è¯•
    â”œâ”€â”€ index.test.js          # åœ°å€æ ¼å¼åŒ–å‡½æ•°æµ‹è¯•
    â””â”€â”€ sum.test.js            # æ•°å­¦è®¡ç®—å‡½æ•°æµ‹è¯•
```

### æµ‹è¯•ç¯å¢ƒè®¾ç½®

#### setupTests.js - æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–

```javascript
// å¯¼å…¥ Jest DOM åŒ¹é…å™¨
require('@testing-library/jest-dom');

// æ¨¡æ‹Ÿ Web3 ç›¸å…³çš„å…¨å±€å¯¹è±¡
Object.defineProperty(window, 'ethereum', {
  writable: true,
  value: {
    request: jest.fn(),
    on: jest.fn(),
    removeListener: jest.fn(),
    isMetaMask: true,
  },
});

// æ¨¡æ‹Ÿ matchMedia (ç”¨äºå“åº”å¼æµ‹è¯•)
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: jest.fn().mockImplementation((query) => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});

// æ¨¡æ‹Ÿ ResizeObserver å’Œ IntersectionObserver
global.ResizeObserver = jest.fn().mockImplementation(() => ({
  observe: jest.fn(),
  unobserve: jest.fn(),
  disconnect: jest.fn(),
}));

global.IntersectionObserver = jest.fn().mockImplementation(() => ({
  observe: jest.fn(),
  unobserve: jest.fn(),
  disconnect: jest.fn(),
}));

// è®¾ç½®æµ‹è¯•è¶…æ—¶æ—¶é—´
jest.setTimeout(10000);
```

### è¯¦ç»†æµ‹è¯•æ¡ˆä¾‹ï¼šåœ°å€æ ¼å¼åŒ–å·¥å…·å‡½æ•°

ä»¥ä¸‹æ˜¯é¡¹ç›®ä¸­ `addressFormat` å·¥å…·å‡½æ•°çš„å®Œæ•´æµ‹è¯•æ¡ˆä¾‹ï¼š

```javascript
// tests/unit/utils/index.test.js
import { addressFormat } from '../../../src/utils/index';

describe('addressFormat', () => {
  // æµ‹è¯•æœ‰æ•ˆä»¥å¤ªåŠåœ°å€çš„æ ¼å¼åŒ–
  test('formats valid Ethereum address correctly', () => {
    const address = '0x1234567890123456789012345678901234567890';
    const result = addressFormat(address);
    expect(result).toBe('0x1234...7890');
  });

  // æµ‹è¯•çŸ­åœ°å€å¤„ç†
  test('handles short address correctly', () => {
    const address = '0x123456';
    const result = addressFormat(address);
    expect(result).toBe('0x1234...3456');
  });

  // æµ‹è¯•é0xå¼€å¤´åœ°å€å¤„ç†
  test('returns "æ— æ•ˆåœ°å€" for address not starting with 0x', () => {
    const address = '1234567890123456789012345678901234567890';
    const result = addressFormat(address);
    expect(result).toBe('æ— æ•ˆåœ°å€');
  });

  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²å¤„ç†
  test('returns "æ— æ•ˆåœ°å€" for empty string', () => {
    const address = '';
    const result = addressFormat(address);
    expect(result).toBe('æ— æ•ˆåœ°å€');
  });

  // æµ‹è¯•nullå’Œundefinedå¤„ç†
  test('returns "æ— æ•ˆåœ°å€" for null input', () => {
    const result = addressFormat(null);
    expect(result).toBe('æ— æ•ˆåœ°å€');
  });

  test('returns "æ— æ•ˆåœ°å€" for undefined input', () => {
    const result = addressFormat(undefined);
    expect(result).toBe('æ— æ•ˆåœ°å€');
  });

  // æµ‹è¯•è¾¹ç•Œå€¼
  test('handles minimum valid address length', () => {
    const address = '0x1234';
    const result = addressFormat(address);
    expect(result).toBe('0x1234...1234');
  });

  // æµ‹è¯•æé•¿åœ°å€
  test('handles very long address', () => {
    const address = '0x' + '1'.repeat(100);
    const result = addressFormat(address);
    expect(result).toBe('0x1111...1111');
  });

  // æµ‹è¯•æ··åˆå¤§å°å†™åœ°å€
  test('handles address with mixed case', () => {
    const address = '0xAbCdEf1234567890123456789012345678901234';
    const result = addressFormat(address);
    expect(result).toBe('0xAbCd...1234');
  });
});
```

### æµ‹è¯•æœ€ä½³å®è·µ

1. **æµ‹è¯•ç»“æ„**ï¼šä½¿ç”¨ AAA æ¨¡å¼ï¼ˆArrangeã€Actã€Assertï¼‰
2. **æµ‹è¯•å‘½å**ï¼šä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
3. **æ¨¡æ‹Ÿä¾èµ–**ï¼šé€‚å½“ä½¿ç”¨ mock éš”ç¦»æµ‹è¯•å•å…ƒ
4. **å¼‚æ­¥æµ‹è¯•**ï¼šä½¿ç”¨ `async/await` å’Œ `waitFor` å¤„ç†å¼‚æ­¥æ“ä½œ
5. **è¦†ç›–ç‡ç›®æ ‡**ï¼šä¿æŒ 70% ä»¥ä¸Šçš„æµ‹è¯•è¦†ç›–ç‡

## E2Eæµ‹è¯•ç³»ç»Ÿ

### æµ‹è¯•æ¶æ„

```
tests/e2e/
â”œâ”€â”€ support/
â”‚   â”œâ”€â”€ commands.js          # è‡ªå®šä¹‰å‘½ä»¤å®šä¹‰
â”‚   â””â”€â”€ e2e.js              # å…¨å±€é…ç½®
â”œâ”€â”€ fixtures/
â”‚   â””â”€â”€ redPacketData.json  # æµ‹è¯•æ•°æ®
â”œâ”€â”€ wallet-connection.cy.js  # é’±åŒ…è¿æ¥æµ‹è¯•
â”œâ”€â”€ wallet-web3.cy.js       # Web3 åŠŸèƒ½æµ‹è¯•
â””â”€â”€ README.md               # E2E æµ‹è¯•æ–‡æ¡£
```

### Web3 é’±åŒ…æ¨¡æ‹Ÿç³»ç»Ÿ

#### è‡ªå®šä¹‰å‘½ä»¤ (commands.js)

```javascript
// è®¾ç½® MetaMask æ¨¡æ‹Ÿç¯å¢ƒ
Cypress.Commands.add('setupMetaMask', (options = {}) => {
  const config = {
    address: options.address || '0x742d35Cc6634C0532925a3b8D4C9db96590c6C87',
    chainId: options.chainId || '0x1',
    networkId: options.networkId || '1',
    balance: options.balance || '0x1bc16d674ec80000', // 2 ETH
    ...options,
  };

  cy.on('window:before:load', (win) => {
    // åˆ›å»ºå®Œæ•´çš„MetaMask provider
    const metamaskProvider = {
      isMetaMask: true,
      selectedAddress: config.address,
      chainId: config.chainId,
      networkVersion: config.networkId,

      // ä¸»è¦çš„requestæ–¹æ³•
      request: async ({ method, params = [] }) => {
        console.log(`ğŸ¦Š MetaMask ${method}:`, params);

        switch (method) {
          case 'eth_requestAccounts':
          case 'eth_accounts':
            return [config.address];

          case 'eth_chainId':
            return config.chainId;

          case 'eth_getBalance':
            return config.balance;

          case 'eth_sendTransaction':
            return '0x' + Math.random().toString(16).substr(2, 64);

          case 'personal_sign':
            return '0x' + Math.random().toString(16).substr(2, 130);

          default:
            throw new Error(`Unsupported method: ${method}`);
        }
      },

      // äº‹ä»¶ç³»ç»Ÿ
      on: (event, callback) => {
        if (!win.ethereum._events) win.ethereum._events = {};
        if (!win.ethereum._events[event]) win.ethereum._events[event] = [];
        win.ethereum._events[event].push(callback);
      },

      emit: (event, ...args) => {
        if (win.ethereum._events && win.ethereum._events[event]) {
          win.ethereum._events[event].forEach((callback) => {
            try {
              callback(...args);
            } catch (err) {
              console.error('äº‹ä»¶å¤„ç†å™¨é”™è¯¯:', err);
            }
          });
        }
      },
    };

    win.ethereum = metamaskProvider;
    console.log('âœ… MetaMask initialized successfully');
  });
});

// è¿æ¥é’±åŒ…å‘½ä»¤
Cypress.Commands.add('connectWallet', () => {
  cy.window().then(async (win) => {
    if (win.ethereum) {
      const accounts = await win.ethereum.request({
        method: 'eth_requestAccounts',
      });
      console.log('ğŸ”— Wallet connected:', accounts[0]);
      return accounts;
    }
  });
});

// åˆ‡æ¢ç½‘ç»œå‘½ä»¤
Cypress.Commands.add('changeMetaMaskNetwork', (network) => {
  const networks = {
    mainnet: { chainId: '0x1', networkId: '1' },
    goerli: { chainId: '0x5', networkId: '5' },
    sepolia: { chainId: '0xaa36a7', networkId: '11155111' },
    localhost: { chainId: '0x539', networkId: '1337' },
  };

  const networkConfig = networks[network] || networks.mainnet;

  cy.window().then((win) => {
    if (win.ethereum) {
      win.ethereum.chainId = networkConfig.chainId;
      win.ethereum.networkVersion = networkConfig.networkId;
      win.ethereum.emit('chainChanged', networkConfig.chainId);
      console.log(`ğŸŒ Network changed to: ${network}`);
    }
  });
});
```

### è¯¦ç»†æµ‹è¯•æ¡ˆä¾‹ï¼šé’±åŒ…è¿æ¥æµç¨‹

ä»¥ä¸‹æ˜¯é¡¹ç›®ä¸­é’±åŒ…è¿æ¥åŠŸèƒ½çš„å®Œæ•´E2Eæµ‹è¯•æ¡ˆä¾‹ï¼š

```javascript
// tests/e2e/wallet-connection.cy.js
describe('é’±åŒ…è¿æ¥ E2E æµ‹è¯•', () => {
  beforeEach(() => {
    // ä½¿ç”¨onBeforeLoadåœ¨é¡µé¢åŠ è½½å‰è®¾ç½®window.ethereum
    cy.visitWithWalletMocks('/');
    // ç­‰å¾…é¡µé¢åŠ è½½å’ŒuseWalletåˆå§‹åŒ–å®Œæˆ
    cy.wait(3000);
  });

  describe('æ•´ä½“çš„æµ‹è¯•æµç¨‹', () => {
    it('æ˜¾ç¤ºé¡µé¢åˆå§‹UI', () => {
      console.log('ğŸ“‹ æ­¥éª¤1: éªŒè¯é¡µé¢åŸºæœ¬å…ƒç´ ');
      cy.contains('çº¢åŒ…åˆçº¦').should('be.visible');
    });

    it('æ‰‹åŠ¨è¿æ¥--æµ‹è¯•æµç¨‹', () => {
      console.log('\n=== å¼€å§‹æµ‹è¯•æ‰‹åŠ¨è¿æ¥ ===');

      // é‡ç½®è¿æ¥çŠ¶æ€ä¸ºæœªè¿æ¥
      cy.window().then((win) => {
        if (win.ethereum && win.ethereum._resetConnection) {
          win.ethereum._resetConnection();
          // è§¦å‘accountsChangedäº‹ä»¶
          win.ethereum.emit('accountsChanged', []);
        }
      });

      // æ­¥éª¤1: éªŒè¯é¡µé¢åŸºæœ¬å…ƒç´ åŠ è½½
      console.log('ğŸ“‹ æ­¥éª¤1: éªŒè¯é¡µé¢åŸºæœ¬å…ƒç´ ');
      cy.contains('çº¢åŒ…åˆçº¦').should('be.visible');

      // æ­¥éª¤2: éªŒè¯åˆå§‹çŠ¶æ€ - åº”è¯¥æ˜¾ç¤ºè¿æ¥æŒ‰é’®
      console.log('ğŸ” æ­¥éª¤2: æ£€æŸ¥åˆå§‹è¿æ¥çŠ¶æ€');
      cy.get('[data-testid="connect-wallet-button"]')
        .should('be.visible')
        .should('contain', 'è¿æ¥é’±åŒ…')
        .then(() => {
          console.log('âœ… åˆå§‹çŠ¶æ€æ­£ç¡®: æ˜¾ç¤ºè¿æ¥é’±åŒ…æŒ‰é’®');
        });

      // æ­¥éª¤3: ç‚¹å‡»è¿æ¥é’±åŒ…æŒ‰é’®ï¼Œæ¨¡æ‹ŸconnectWalletæµç¨‹
      console.log('ğŸ”— æ­¥éª¤3: å¼€å§‹è¿æ¥é’±åŒ…æµç¨‹');
      cy.get('[data-testid="connect-wallet-button"]')
        .click()
        .then(() => {
          console.log('ğŸ–±ï¸ å·²ç‚¹å‡»è¿æ¥é’±åŒ…æŒ‰é’®');
        });

      // ç­‰å¾…çŠ¶æ€æ›´æ–°
      cy.wait(1000);

      // æ­¥éª¤4: éªŒè¯UIçŠ¶æ€å˜åŒ–
      console.log('ğŸ¯ æ­¥éª¤4: éªŒè¯è¿æ¥åçš„UIçŠ¶æ€');
      cy.get('body').then(($body) => {
        if ($body.find('[data-testid="wallet-info-button"]').length > 0) {
          console.log('âœ… å‘ç°é’±åŒ…ä¿¡æ¯æŒ‰é’®ï¼Œè¿æ¥æˆåŠŸ');
          cy.get('[data-testid="wallet-info-button"]')
            .should('be.visible')
            .then(() => {
              console.log('âœ… é’±åŒ…ä¿¡æ¯æŒ‰é’®å¯è§ï¼Œæµ‹è¯•é€šè¿‡');
            });
        } else {
          console.log('âš ï¸ æœªå‘ç°é’±åŒ…ä¿¡æ¯æŒ‰é’®ï¼Œæ£€æŸ¥æ˜¯å¦ä»æ˜¾ç¤ºè¿æ¥æŒ‰é’®');
          cy.get('[data-testid="connect-wallet-button"]')
            .should('be.visible')
            .then(() => {
              console.log('â„¹ï¸ ä»æ˜¾ç¤ºè¿æ¥æŒ‰é’®ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´æ¨¡æ‹Ÿé€»è¾‘');
            });
        }
      });

      console.log('ğŸ æ‰‹åŠ¨æµ‹è¯•å®Œæˆ');
    });

    it('åº”è¯¥æ£€æµ‹åˆ°Web3é’±åŒ…ä¿¡æ¯', () => {
      cy.window().should('have.property', 'ethereum');
      cy.window().then((win) => {
        expect(win.ethereum).to.have.property('isMetaMask', true);
        expect(win.ethereum).to.have.property('selectedAddress');
        expect(win.ethereum.selectedAddress).to.match(/^0x[a-fA-F0-9]{40}$/);
      });
    });
  });
});
```

### E2Eæµ‹è¯•æœ€ä½³å®è·µ

1. **é¡µé¢åŠ è½½å‰è®¾ç½®**ï¼šä½¿ç”¨ `onBeforeLoad` åœ¨é¡µé¢åŠ è½½å‰è®¾ç½® `window.ethereum`
2. **ç­‰å¾…æœºåˆ¶**ï¼šç»™é’±åŒ…åˆå§‹åŒ–ç•™å‡ºè¶³å¤Ÿæ—¶é—´
3. **é”™è¯¯å¤„ç†**ï¼šå¿½ç•¥Web3ç›¸å…³çš„é¢„æœŸé”™è¯¯
4. **æ•°æ®æ¸…ç†**ï¼šæ¯ä¸ªæµ‹è¯•å‰æ¸…ç†æœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨
5. **è§†è§‰éªŒè¯**ï¼šä½¿ç”¨æˆªå›¾å’Œè§†é¢‘è®°å½•æµ‹è¯•è¿‡ç¨‹

## package.json è„šæœ¬é…ç½®

```json
{
  "scripts": {
    "test:unit": "jest",
    "test:unit:ci": "jest --coverage --watchAll=false --ci --passWithNoTests",
    "test:e2e": "cypress open",
    "test:e2e:ci": "cypress run --headless --browser chrome",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:all": "npm run test:unit && npm run test:e2e:ci"
  }
}
```

## æµ‹è¯•æŠ¥å‘Šå’Œè¦†ç›–ç‡

### Jest Stare æŠ¥å‘Š

- **æŠ¥å‘Šç›®å½•**: `jest-stare/`
- **æŠ¥å‘Šæ ‡é¢˜**: "Web3 Frontend Tests"
- **è¦†ç›–ç‡é“¾æ¥**: è‡ªåŠ¨é“¾æ¥åˆ°è¦†ç›–ç‡æŠ¥å‘Š

### è¦†ç›–ç‡é…ç½®

```javascript
// è¦†ç›–ç‡æ”¶é›†èŒƒå›´
collectCoverageFrom: [
  'src/**/*.{js,jsx,ts,tsx}',
  '!src/**/*.d.ts',
  '!src/index.tsx',
  '!src/reportWebVitals.ts',
],

// è¦†ç›–ç‡æŠ¥å‘Šæ ¼å¼
coverageReporters: ['text', 'lcov', 'html'],
```

## æœ€ä½³å®è·µ

### å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ

1. **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
2. **æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–**ï¼šä½¿ç”¨ Jest mock æ¨¡æ‹Ÿ Web3 æä¾›è€…
3. **å¼‚æ­¥æµ‹è¯•**ï¼šæ­£ç¡®å¤„ç† Promise å’Œå¼‚æ­¥æ“ä½œ
4. **è¾¹ç•Œå€¼æµ‹è¯•**ï¼šæµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
5. **å¯è¯»æ€§**ï¼šä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°å’Œæ¸…æ™°çš„æ–­è¨€

### E2Eæµ‹è¯•æœ€ä½³å®è·µ

1. **ç¯å¢ƒä¸€è‡´æ€§**ï¼šç¡®ä¿æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´
2. **æ•°æ®ç®¡ç†**ï¼šä½¿ç”¨å›ºå®šçš„æµ‹è¯•æ•°æ®å’Œæ¸…ç†æœºåˆ¶
3. **ç­‰å¾…ç­–ç•¥**ï¼šä½¿ç”¨æ™ºèƒ½ç­‰å¾…è€Œéå›ºå®šå»¶æ—¶
4. **é”™è¯¯æ¢å¤**ï¼šå®ç°æµ‹è¯•å¤±è´¥æ—¶çš„é‡è¯•æœºåˆ¶
5. **å¹¶è¡Œæ‰§è¡Œ**ï¼šåˆç†é…ç½®å¹¶è¡Œæµ‹è¯•ä»¥æé«˜æ•ˆç‡

## æŒç»­é›†æˆé…ç½®

### GitHub Actions ç¤ºä¾‹

```yaml
name: Tests
on: [push, pull_request]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run test:unit:ci

  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run dev &
      - run: npm run test:e2e:ci
```

## ç›¸å…³æ–‡æ¡£é“¾æ¥

- [Jest å®˜æ–¹æ–‡æ¡£](https://jestjs.io/docs/getting-started)
- [React Testing Library æ–‡æ¡£](https://testing-library.com/docs/react-testing-library/intro/)
- [Cypress å®˜æ–¹æ–‡æ¡£](https://docs.cypress.io/)
- [Web3 æµ‹è¯•æœ€ä½³å®è·µ](https://ethereum.org/en/developers/docs/testing/)
- [é¡¹ç›® Webpack æ„å»ºç³»ç»Ÿ](./05-Webpackæ„å»ºç³»ç»Ÿ.md)
- [é¡¹ç›® Web3 é›†æˆç³»ç»Ÿ](./06-Web3é›†æˆç³»ç»Ÿ.md)

---

**æ³¨æ„**: æœ¬æ–‡æ¡£åŸºäºé¡¹ç›®å½“å‰çš„æµ‹è¯•é…ç½®å’Œä¾èµ–ç‰ˆæœ¬ã€‚åœ¨å‡çº§ä¾èµ–æ—¶ï¼Œè¯·ç›¸åº”æ›´æ–°é…ç½®æ–‡ä»¶å’Œæµ‹è¯•ä»£ç ã€‚
